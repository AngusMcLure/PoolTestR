a <- as.array(as.matrix(dplyr::select(DataTrend, Result))[,1])
a
dim(a)
a %>% class
f
f$b <- a
f
f$b
f$b %>% class
f$b %>% dim
a <- as.array(as.matrix(dplyr::select(DataTrend, Result))[1,1])
a
dim(a)
f$b <- a
dim(f$b)
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
N <- 20
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
array(1)
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
as.array(as.matrix(dplyr::select(data, !! TestResult))[,1])
array(as.matrix(dplyr::select(data, !! TestResult))[,1])
data
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
N <- 20
Data <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000,2001,2002),N, replace = T),
NumInPool = sample(10:30,N, replace = T),
Result = sample(0:1,N,replace = T)
)
array(as.matrix(dplyr::select(Data, Result))[,1])
as.array(as.matrix(dplyr::select(Data, Result))[,1])
f$a <- array(as.matrix(dplyr::select(Data, Result))[,1])
f <- list()
f$a <- array(as.matrix(dplyr::select(Data, Result))[,1])
f$b <- as.array(as.matrix(dplyr::select(Data, Result))[,1])
f
f$a %>% dim
f$b %>% dim
Data
as.array(as.matrix(dplyr::select(Data %>% subset(Place == "A"& Year ==2001), Result))[,1])
array(as.matrix(dplyr::select(Data %>% subset(Place == "A"& Year ==2001), Result))[,1])
array(as.matrix(dplyr::select(Data %>% subset(Place == "B"& Year ==2001), Result))[,1])
array(as.matrix(dplyr::select(Data %>% subset(Place == "C"& Year ==2001), Result))[,1])
array(as.matrix(dplyr::select(Data %>% subset(Place == "D" & Year ==2001), Result))[,1])
array(as.matrix(dplyr::select(Data %>% subset(Place == "D" & Year ==200), Result))[,1])
array(as.matrix(dplyr::select(Data %>% subset(Place == "D" & Year ==2000), Result))[,1])
array(as.matrix(dplyr::select(Data %>% subset(Place == "D" & Year ==2000), Result))[,1]) %>% dim
as.array(as.matrix(dplyr::select(Data %>% subset(Place == "D" & Year ==2000), Result))[,1]) %>% dim
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000:2002), N, replace = T),
NumInPool = sample(5:10, N, replace = T)
)
BasePrev <- c(A = 0.1, B = 0.05, C = 0.02, D = 0.1)
GrowthRate = -0.5
DataTrend$TruePrev <- with(DataTrend,
BasePrev[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$Result <- with(DataTrend,
runif(N) < 1-(1-TruePrev)^NumInPool)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
array(as.matrix(dplyr::select(Data %>% subset(Place == "D" & Year ==2000), Result))[,1])
array(as.matrix(dplyr::select(DataTrend %>% subset(Place == "D" & Year ==2000), Result))[,1])
array(as.matrix(dplyr::select(DataTrend %>% subset(Place == "D" & Year ==2000), Result))[,1]) %>% as.numeric()
DataTrend$Result <- with(DataTrend,
as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool)
)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
N <- 20
Data <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000,2001,2002),N, replace = T),
NumInPool = sample(10:30,N, replace = T),
Result = sample(0:1,N,replace = T)
)
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000:2002), N, replace = T),
NumInPool = sample(5:10, N, replace = T)
)
BasePrev <- c(A = 0.1, B = 0.05, C = 0.02, D = 0.1)
GrowthRate = -0.5
DataTrend$TruePrev <- with(DataTrend,
BasePrev[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$Result <- with(DataTrend,
as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool)
)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
as.numeric(1,drop =F)
as.numeric(matrix(1),drop =F)
as.numeric(matrix(1),drop =F) %>% class()
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
dplyr::select(DataTrend %>% subset(Place == "D" & Year ==2000), Result)
as.logical(dplyr::select(DataTrend %>% subset(Place == "D" & Year ==2000), Result))
array(c(T, T, F))
array(c(T, T, F)) %>% as.numerica
array(c(T, T, F)) %>% as.numeric
array(c(T, T, F)) %>% as.numeric %>% dim
array(c(T, T, F)) %>% as.numeric %>% class
dplyr::select()
help("select.list")
help("select")
dplyr::select(Data, Result))[,1] %>% as.matrix
dplyr::select(Data, Result)[,1] %>% as.matrix
dplyr::select(Data, Result)[,1] %>% as.matrix %>% as.numeric()
dplyr::select(Data, Result)[,1] %>% as.matrix %>% as.numeric() %>% array()
array(1)
array(1) %>% dim
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
N <- 20
Data <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000,2001,2002),N, replace = T),
NumInPool = sample(10:30,N, replace = T),
Result = sample(0:1,N,replace = T)
)
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000:2002), N, replace = T),
NumInPool = sample(5:10, N, replace = T)
)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
DataTrend$Result <- with(DataTrend,
as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool)
)
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000:2002), N, replace = T),
NumInPool = sample(5:10, N, replace = T)
)
BasePrev <- c(A = 0.1, B = 0.05, C = 0.02, D = 0.1)
GrowthRate = -0.5
DataTrend$TruePrev <- with(DataTrend,
BasePrev[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$Result <- with(DataTrend,
as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool)
)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year, prior.absent = 0.1)
PrevsYearPlaceTrend
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year, prior.absent = 0.01)
PrevsYearPlaceTrend
N <- 200
Data <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000,2001,2002),N, replace = T),
NumInPool = sample(10:30,N, replace = T),
Result = sample(0:1,N,replace = T)
)
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000:2002), N, replace = T),
NumInPool = sample(5:10, N, replace = T)
)
BasePrev <- c(A = 0.1, B = 0.05, C = 0.002, D = 0.1)
GrowthRate = -0.5
DataTrend$TruePrev <- with(DataTrend,
BasePrev[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$Result <- with(DataTrend,
as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool)
)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
PrevsYearPlaceTrend
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
N <- 200
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
PrevsYearPlaceTrend
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.01)
PrevsYearPlaceTrend
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.1)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.1)
PrevsYearPlaceTrend
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.1)
PrevsYearPlaceTrend
N <- 20
N <- 10
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000:2002), N, replace = T),
NumInPool = sample(5:10, N, replace = T)
)
BasePrev <- c(A = 0.1, B = 0.05, C = 0.002, D = 0.1)
GrowthRate = -0.5
DataTrend$TruePrev <- with(DataTrend,
BasePrev[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$Result <- with(DataTrend,
as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool)
)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
PrevsYearPlaceTrend
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
N <- 10
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000:2002), N, replace = T),
NumInPool = sample(5:10, N, replace = T)
)
BasePrev <- c(A = 0.1, B = 0.05, C = 0.002, D = 0.1)
GrowthRate = -0.5
DataTrend$TruePrev <- with(DataTrend,
BasePrev[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$Result <- with(DataTrend,
as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool)
)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
PrevsYearPlaceTrend
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
N <- 10
Data <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000,2001,2002),N, replace = T),
NumInPool = sample(10:30,N, replace = T),
Result = sample(0:1,N,replace = T)
)
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000:2002), N, replace = T),
NumInPool = sample(5:10, N, replace = T)
)
BasePrev <- c(A = 0.1, B = 0.05, C = 0.002, D = 0.1)
GrowthRate = -0.5
DataTrend$TruePrev <- with(DataTrend,
BasePrev[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$Result <- with(DataTrend,
as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool)
)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
PoolPrev(DataTrend,Result,NumInPool)
PoolPrev(DataTrend,Result,NumInPool) %>% summary()
PoolPrev(DataTrend,Result,NumInPool) %>% summary(probs = NULL)
out <- data.frame()
our
out
out$A <- 1
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
N <- 10
Data <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000,2001,2002),N, replace = T),
NumInPool = sample(10:30,N, replace = T),
Result = sample(0:1,N,replace = T)
)
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000:2002), N, replace = T),
NumInPool = sample(5:10, N, replace = T)
)
BasePrev <- c(A = 0.1, B = 0.05, C = 0.002, D = 0.1)
GrowthRate = -0.5
DataTrend$TruePrev <- with(DataTrend,
BasePrev[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$Result <- with(DataTrend,
as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool)
)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
PrevsYearPlaceTrend
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.1)
PrevsYearPlaceTrend <- PoolPrev(DataTrend)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool)
PrevsYearPlaceTrend
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool)
PrevsYearPlaceTrend
PrevsYearPlaceTrend %>% quantile(probs = c(0.1))
help(summary.stanfit)
PrevsYearPlaceTrend %>% class
help(summary.stanfit)
??summary.stanfit
PrevsYearPlaceTrend %>% as.mcmc
PrevsYearPlaceTrend %>% mcmc
PrevsYearPlaceTrend %>% coda::mcmc
PrevsYearPlaceTrend %>% coda::as.mcmc()
PrevsYearPlaceTrend %>% coda::as.mcmc() %>% quantile()
PrevsYearPlaceTrend %>% aas.matrix()
PrevsYearPlaceTrend %>% as.matrix()
PrevsYearPlaceTrend %>% as.matrix() %>% quantile(0.1)
as.matrix(PrevsYearPlaceTrend) %>% quantile(0.1)
as.matrix(PrevsYearPlaceTrend)[,"p"] %>% quantile(0.1)
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year)
PrevsYearPlaceTrend
DataTrend
PrevsYearPlaceTrend
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.1)
PrevsYearPlaceTrend
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.7)
PrevsYearPlaceTrend
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.9)
PrevsYearPlaceTrend
N <- 1000
Data <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000,2001,2002),N, replace = T),
NumInPool = sample(10:30,N, replace = T),
Result = sample(0:1,N,replace = T)
)
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000:2002), N, replace = T),
NumInPool = sample(5:10, N, replace = T)
)
BasePrev <- c(A = 0.1, B = 0.05, C = 0.002, D = 0)
GrowthRate = -0.5
DataTrend$TruePrev <- with(DataTrend,
BasePrev[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$Result <- with(DataTrend,
as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool)
)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.01)
PrevsYearPlaceTrend
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000:2002), N, replace = T),
NumInPool = sample(5:20, N, replace = T)
)
BasePrev <- c(A = 0.1, B = 0.05, C = 0.002, D = 0)
GrowthRate = -0.5
DataTrend$TruePrev <- with(DataTrend,
BasePrev[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$Result <- with(DataTrend,
as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool)
)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.01)
PrevsYearPlaceTrend
#Fake data with no trend
pkgbuild::compile_dll()
roxygen2::roxygenize()
N <- 1000
Data <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000,2001,2002),N, replace = T),
NumInPool = sample(10:30,N, replace = T),
Result = sample(0:1,N,replace = T)
)
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000:2002), N, replace = T),
NumInPool = sample(5:20, N, replace = T)
)
BasePrev <- c(A = 0.1, B = 0.05, C = 0.002, D = 0)
GrowthRate = -0.5
DataTrend$TruePrev <- with(DataTrend,
BasePrev[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$Result <- with(DataTrend,
as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool)
)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.05)
PrevsYearPlaceTrend
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.03)
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.03)
PrevsYearPlaceTrend
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.03)
PrevsYearPlaceTrend
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.1)
PrevsYearPlaceTrend
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.95)
PrevsYearPlaceTrend
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.1)
PrevsYearPlaceTrend
RegPlace <- PooledLogitRegression(DataTrend,"NumInPool",Result ~ Place,verbose = T)
RegPlace
exp(rstan::summary(RegPlace$fit)$summary)
#This has issues - the model matrix regularisation doesn't work that well here.
#This makes it slow to run, but should still have correct result.
#A way round this would be to do a change of varaibles to make 2000 year 0.
RegFull <- PooledRegression(DataTrend,"NumInPool",Result ~ Place*Year,verbose = T)
RegFull
#This has issues - the model matrix regularisation doesn't work that well here.
#This makes it slow to run, but should still have correct result.
#A way round this would be to do a change of varaibles to make 2000 year 0.
RegFull <- PooledLogitRegression(DataTrend,"NumInPool",Result ~ Place*Year,verbose = T)
RegFull
exp(rstan::summary(RegFull$fit)$summary)
RegYearPlaceTrend <- PooledLogitRegression(DataTrend,"NumInPool",Result ~ Year + Place,verbose = T)
RegYearPlaceTrend
exp(rstan::summary(RegYearPlaceTrend$fit)$summary)
rstan::summary(RegYearPlaceTrend$fit)
exp(rstan::summary(RegYearPlaceTrend$fit)$summary)
rstanarmTest <- rstanarm::stan_glm(formula = Result ~ Year + Place,family = binomial(), data = DataTrend)
rstanarmTest
test <- glm(Result ~ Year + Place,data = DataTrend,family = 'binomial')
test
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000:2002), N, replace = T),
NumInPool = sample(5:20, N, replace = T)
)
BasePrev <- c(A = 0.1, B = 0.05, C = 0.002, D = 0.1)
GrowthRate = -0.5
DataTrend$TruePrev <- with(DataTrend,BasePrev[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$Result <- with(DataTrend,as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool))
RegYearPlaceTrend <- PooledLogitRegression(DataTrend,"NumInPool",Result ~ Year + Place,verbose = T)
RegYearPlaceTrend
exp(rstan::summary(RegYearPlaceTrend$fit)$summary)
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(0:2), N, replace = T),
NumInPool = sample(5:20, N, replace = T)
)
BasePrev <- c(A = 0.1, B = 0.05, C = 0.002, D = 0.1)
GrowthRate = -0.5
DataTrend$TruePrev <- with(DataTrend,BasePrev[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$Result <- with(DataTrend,as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool))
RegYearPlaceTrend <- PooledLogitRegression(DataTrend,"NumInPool",Result ~ Year + Place,verbose = T)
RegYearPlaceTrend
exp(rstan::summary(RegYearPlaceTrend$fit)$summary)
N <- 500
Data <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000,2001,2002),N, replace = T),
NumInPool = sample(10:30,N, replace = T),
Result = sample(0:1,N,replace = T)
)
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(0:2), N, replace = T),
NumInPool = sample(5:20, N, replace = T)
)
BasePrev <- c(A = 0.1, B = 0.05, C = 0.002, D = 0.1)
GrowthRate = -0.5
DataTrend$TruePrev <- with(DataTrend,BasePrev[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$Result <- with(DataTrend,as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool))
PrevsYearPlaceTrend <- PoolPrev(DataTrend,Result,NumInPool,Place,Year,prior.absent = 0.1)
PrevsYearPlaceTrend
RegPlace <- PooledLogitRegression(DataTrend,"NumInPool",Result ~ Place,verbose = T)
RegYearPlaceTrend <- PooledLogitRegression(DataTrend,"NumInPool",Result ~ Year + Place,verbose = T)
RegYearPlaceTrend
exp(rstan::summary(RegYearPlaceTrend$fit)$summary)
DataTrend$Result <- with(DataTrend,as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool))
RegYearPlaceTrend <- PooledLogitRegression(DataTrend,"NumInPool",Result ~ Year + Place,verbose = T)
RegYearPlaceTrend
exp(rstan::summary(RegYearPlaceTrend$fit)$summary)
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(0:2), N, replace = T),
NumInPool = sample(1:20, N, replace = T)
)
BasePrev <- c(A = 0.1, B = 0.05, C = 0.002, D = 0.1)
GrowthRate = -0.5
DataTrend$TruePrev <- with(DataTrend,BasePrev[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$Result <- with(DataTrend,as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool))
RegYearPlaceTrend <- PooledLogitRegression(DataTrend,"NumInPool",Result ~ Year + Place,verbose = T)
RegYearPlaceTrend
exp(rstan::summary(RegYearPlaceTrend$fit)$summary)
BaseOdds <- c(A = 0.1, B = 0.05, C = 0.002, D = 0.1)
GrowthRate = -0.5
logit <- function(p){log(p) - log(1-p)}
inv.logit <- function(q){exp(q)/(1+exp(q))}
DataTrend$TrueOdds <- with(DataTrend,BaseOdds[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$TruePrev <- with(DataTrend, TrueOdds/(1+TrueOdds))
DataTrend$Result <- with(DataTrend,as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool))
RegYearPlaceTrend <- PooledLogitRegression(DataTrend,"NumInPool",Result ~ Year + Place,verbose = T)
RegYearPlaceTrend
exp(rstan::summary(RegYearPlaceTrend$fit)$summary)
N <- 5000
Data <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(2000,2001,2002),N, replace = T),
NumInPool = sample(10:30,N, replace = T),
Result = sample(0:1,N,replace = T)
)
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(0:2), N, replace = T),
NumInPool = sample(1:20, N, replace = T)
)
BaseOdds <- c(A = 0.1, B = 0.05, C = 0.002, D = 0.1)
GrowthRate = -0.5
logit <- function(p){log(p) - log(1-p)}
inv.logit <- function(q){exp(q)/(1+exp(q))}
DataTrend$TrueOdds <- with(DataTrend,BaseOdds[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$TruePrev <- with(DataTrend, TrueOdds/(1+TrueOdds))
DataTrend$Result <- with(DataTrend,as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool))
RegYearPlaceTrend <- PooledLogitRegression(DataTrend,"NumInPool",Result ~ Year + Place,verbose = T)
RegYearPlaceTrend
exp(rstan::summary(RegYearPlaceTrend$fit)$summary)
rstan::summary(RegYearPlaceTrend$fit)$summary
test <- glm(Result ~ Year + Place,data = DataTrend,family = 'binomial')
test
DataTrend <- data.frame(Place = sample(c("A","B","C","D"),N, replace = T),
Year = sample(c(0:2), N, replace = T),
NumInPool = sample(20:25, N, replace = T)
)
BaseOdds <- c(A = 0.1, B = 0.05, C = 0.002, D = 0.1)
GrowthRate = -0.5
logit <- function(p){log(p) - log(1-p)}
inv.logit <- function(q){exp(q)/(1+exp(q))}
DataTrend$TrueOdds <- with(DataTrend,BaseOdds[Place] * exp(GrowthRate*(Year-min(Year))))
DataTrend$TruePrev <- with(DataTrend, TrueOdds/(1+TrueOdds))
DataTrend$Result <- with(DataTrend,as.numeric(runif(N) < 1-(1-TruePrev)^NumInPool))
test <- glm(Result ~ Year + Place,data = DataTrend,family = 'binomial')
test
rstanarmTest <- rstanarm::stan_glm(formula = Result ~ Year + Place,family = binomial(), data = DataTrend)
rstanarmTest
